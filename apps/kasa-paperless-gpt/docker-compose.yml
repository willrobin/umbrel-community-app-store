version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: kasa-paperless-gpt_server_1
      APP_PORT: 8080

  server:
    image: icereed/paperless-gpt:v0.24.0
    init: true
    restart: on-failure
    stop_grace_period: 30s
    environment:
      # Paperless-ngx connection (update PAPERLESS_API_TOKEN after installation)
      PAPERLESS_BASE_URL: "http://${DEVICE_DOMAIN_NAME}:2349"
      PAPERLESS_API_TOKEN: "CHANGE_ME"
      # Tag configuration for document processing
      MANUAL_TAG: "paperless-gpt"
      AUTO_TAG: "paperless-gpt-auto"
      # LLM Provider configuration (default: Ollama)
      LLM_PROVIDER: "ollama"
      LLM_MODEL: "llama3.1:8b"
      OLLAMA_HOST: "http://${DEVICE_DOMAIN_NAME}:11434"
      # Token limits
      TOKEN_LIMIT: "4096"
      # Optional: For OpenAI, uncomment and set:
      # LLM_PROVIDER: "openai"
      # LLM_MODEL: "gpt-4o-mini"
      # OPENAI_API_KEY: "your-api-key"
      # Optional: For Anthropic Claude, uncomment and set:
      # LLM_PROVIDER: "anthropic"
      # LLM_MODEL: "claude-3-haiku-20240307"
      # ANTHROPIC_API_KEY: "your-api-key"
    volumes:
      - ${APP_DATA_DIR}/data/prompts:/app/prompts
      - ${APP_DATA_DIR}/data/db:/app/db
