version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: server
      APP_PORT: 8080

  server:
    image: icereed/paperless-gpt:v0.23.0
    user: "1000:1000"
    init: true
    restart: unless-stopped
    stop_grace_period: 30s
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges=true
    environment:
      # Set this to your Paperless-ngx URL (Umbrel typically uses port 2349).
      PAPERLESS_BASE_URL: "http://${DEVICE_DOMAIN_NAME}:2349"
      PAPERLESS_API_TOKEN: "CHANGE_ME"
      MANUAL_TAG: "paperless-gpt"
      AUTO_TAG: "paperless-gpt-auto"
      LLM_PROVIDER: "ollama"
      LLM_MODEL: "qwen2.5:7b"
      OLLAMA_HOST: "http://${DEVICE_DOMAIN_NAME}:11434"
      TOKEN_LIMIT: "4096"
    volumes:
      - ${APP_DATA_DIR}/prompts:/app/prompts
      - ${APP_DATA_DIR}/db:/app/db
